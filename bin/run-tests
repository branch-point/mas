#!/usr/bin/env bash

if [ ! $# == 1 ]; then
    echo "Usage: $0 <env>"
    exit 1
fi

NIGHTWATCH_ENV=$1

ROOT=$( cd $( dirname "${BASH_SOURCE[0]}" ) && cd .. && pwd )
cd $ROOT

redis-server --port 44144 &
REDIS_PID=$!

echo "Waiting 1 second for the redis to start."
sleep 1

./bin/masctl -b -c start --configFile test/mas-test.conf

if [ "$NIGHTWATCH_ENV" == "default" ]; then
    ./bin/nightwatch --env default
else
    ./bin/nightwatch --env saucelabs-firefox-mac,saucelabs-chrome-linux,saucelabs-ie-win
fi

./bin/masctl -c stop --configFile test/mas-test.conf

kill $REDIS_PID
wait $REDIS_PID
